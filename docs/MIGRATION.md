# æ•°æ®åº“è¡¨åè¿ç§»å®Œæˆ âœ…

## ğŸ“‹ è¿ç§»æ¦‚è¦

**æ—§è¡¨å**: `posts`
**æ–°è¡¨å**: `gold_signals`ï¼ˆé»„é‡‘è¡Œæƒ…ä¿¡å·åˆ†äº«ï¼‰

**è¿ç§»æ—¶é—´**: 2026-01-27
**è¿ç§»åŸå› **: ä½¿ç”¨æ›´ä¸“ä¸šçš„è¡¨åï¼Œå¹¶ä¸ºæœªæ¥åŠŸèƒ½ï¼ˆç”¨æˆ·ç™»å½•ã€åå°ç®¡ç†ï¼‰åšå‡†å¤‡

---

## ğŸ”„ å·²ä¿®æ”¹çš„æ–‡ä»¶

### 1. åç«¯ API
- âœ… [api/posts.py](api/posts.py#L85-L90)
  - è¡¨åï¼š`posts` â†’ `gold_signals`
  - æ–°å¢è¿‡æ»¤æ¡ä»¶ï¼š
    - `deleted_at IS NULL` - åªæ˜¾ç¤ºæœªåˆ é™¤çš„å¸–å­
    - `status = 'published'` - åªæ˜¾ç¤ºå·²å‘å¸ƒçš„å¸–å­

- âœ… [api/webhook.py](api/webhook.py#L81)
  - æ›´æ–°æ³¨é‡Šä¸­çš„è¡¨åå¼•ç”¨

### 2. æ•°æ®åº“è„šæœ¬
- âœ… [database-setup.sql](database-setup.sql) - æ–°ç‰ˆæœ¬ï¼ˆåŸ v2ï¼‰
  - è¡¨åï¼š`gold_signals`
  - æ–°å¢å­—æ®µï¼š
    - `author_id`, `author_name` - ç”¨æˆ·å…³è”
    - `status`, `published_at`, `updated_at` - çŠ¶æ€ç®¡ç†
    - `deleted_at` - è½¯åˆ é™¤
    - `view_count`, `like_count` - ç»Ÿè®¡
  - æ–°å¢è§¦å‘å™¨ï¼šè‡ªåŠ¨æ›´æ–° `updated_at`
  - ä¼˜åŒ– RLS ç­–ç•¥

- ğŸ“¦ [database-setup-old.sql](database-setup-old.sql) - æ—§ç‰ˆæœ¬ï¼ˆå·²å¤‡ä»½ï¼‰

### 3. æ–‡æ¡£
- âœ… [README.md](README.md#L55-L63)
  - æ›´æ–°æ•°æ®åº“åˆ›å»ºè¯´æ˜
  - å¼•ç”¨æ–°çš„å»ºè¡¨è„šæœ¬

### 4. å‰ç«¯ä»£ç 
- âœ… **æ— éœ€ä¿®æ”¹** - å‰ç«¯è°ƒç”¨ `/api/posts` è·¯å¾„ï¼Œä¸å…³å¿ƒè¡¨å

---

## ğŸ“Š æ–°è¡¨ç»“æ„å¯¹æ¯”

| å­—æ®µç±»åˆ« | æ—§ç‰ˆ (posts) | æ–°ç‰ˆ (gold_signals) |
|---------|-------------|-------------------|
| **åŸºç¡€å­—æ®µ** | id, content, image_path | âœ… ä¿ç•™ |
| **ç”¨æˆ·å…³è”** | âŒ æ—  | âœ… author_id, author_name |
| **çŠ¶æ€ç®¡ç†** | âŒ æ—  | âœ… status, published_at, updated_at |
| **è½¯åˆ é™¤** | âŒ æ—  | âœ… deleted_at |
| **ç»Ÿè®¡** | âŒ æ—  | âœ… view_count, like_count |
| **è¿‡æ»¤** | is_filtered | âœ… ä¿ç•™ |
| **æ—¶é—´** | created_at | âœ… ä¿ç•™ + æ–°å¢ |

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. åœ¨ Supabase åˆ›å»ºæ–°è¡¨

åœ¨ Supabase Dashboard â†’ SQL Editor ä¸­æ‰§è¡Œï¼š

```bash
# å¤åˆ¶ database-setup.sql çš„å…¨éƒ¨å†…å®¹å¹¶æ‰§è¡Œ
```

### 2. éªŒè¯è¡¨åˆ›å»º

```sql
-- æŸ¥çœ‹è¡¨ç»“æ„
SELECT column_name, data_type
FROM information_schema.columns
WHERE table_name = 'gold_signals'
ORDER BY ordinal_position;

-- æŸ¥è¯¢æ•°æ®ï¼ˆåº”è¯¥è¿”å›ç©ºç»“æœï¼‰
SELECT * FROM gold_signals WHERE deleted_at IS NULL;
```

### 3. æ’å…¥æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰

```sql
INSERT INTO gold_signals (content, status, is_filtered) VALUES
('é»„é‡‘çªç ´å…³é”®é˜»åŠ›ä½ $2050ï¼Œå»ºè®®å…³æ³¨å›è°ƒä¹°å…¥æœºä¼šã€‚', 'published', FALSE),
('ä»Šæ—¥é»„é‡‘èµ°åŠ¿åˆ†æï¼šå—ç¾è”å‚¨åˆ©ç‡å†³è®®å½±å“ï¼ŒçŸ­æœŸå¯èƒ½éœ‡è¡ã€‚', 'published', FALSE);
```

### 4. éƒ¨ç½²åˆ° Vercel

```bash
# æ–¹å¼ä¸€ï¼šé€šè¿‡ GitHubï¼ˆæ¨èï¼‰
git add .
git commit -m "Migrate table from posts to gold_signals"
git push

# æ–¹å¼äºŒï¼šé€šè¿‡ Vercel CLI
vercel --prod
```

### 5. é…ç½® Vercel ç¯å¢ƒå˜é‡

åœ¨ Vercel Dashboard ä¸­è®¾ç½®ï¼š
- `SUPABASE_URL` = ä½ çš„ Supabase URL
- `SUPABASE_KEY` = ä½ çš„ Supabase anon key

---

## âœ… éªŒè¯æ¸…å•

- [x] åç«¯ API ä»£ç å·²æ›´æ–°
- [x] æ•°æ®åº“è„šæœ¬å·²æ›´æ–°
- [x] README æ–‡æ¡£å·²æ›´æ–°
- [x] å‰ç«¯æ„å»ºæˆåŠŸ
- [ ] Supabase è¡¨å·²åˆ›å»º
- [ ] Vercel ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] é¡¹ç›®å·²éƒ¨ç½²åˆ° Vercel
- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸æ˜¾ç¤ºæ•°æ®

---

## ğŸ”’ å®‰å…¨ç­–ç•¥ (RLS)

æ–°è¡¨çš„ RLS ç­–ç•¥ï¼š

1. **å…¬å¼€è¯»å–**ï¼šæ‰€æœ‰äººå¯ä»¥è¯»å– `status='published'` ä¸” `deleted_at IS NULL` ä¸” `is_filtered=FALSE` çš„å¸–å­
2. **æ’å…¥æƒé™**ï¼šä½¿ç”¨ anon key å¯ä»¥æ’å…¥æ•°æ®
3. **æ›´æ–°æƒé™**ï¼šä½¿ç”¨ anon key å¯ä»¥æ›´æ–°æ•°æ®
4. **ä½œè€…æƒé™**ï¼šç™»å½•ç”¨æˆ·å¯ä»¥ç®¡ç†è‡ªå·±çš„å¸–å­ï¼ˆæœªæ¥åŠŸèƒ½ï¼‰
5. **å®Œå…¨æ§åˆ¶**ï¼šä½¿ç”¨ service_role key å¯ä»¥è¿›è¡Œæ‰€æœ‰æ“ä½œ

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ—§è¡¨æ•°æ®**ï¼šå¦‚æœ Supabase ä¸­å·²æœ‰ `posts` è¡¨çš„æ•°æ®ï¼Œéœ€è¦æ‰‹åŠ¨è¿ç§»
2. **API è·¯å¾„**ï¼šå‰ç«¯ä»ç„¶è°ƒç”¨ `/api/posts`ï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼ˆè·¯å¾„åä¸éœ€è¦æ”¹ï¼‰
3. **ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ Vercel ä¸­é…ç½®äº†æ­£ç¡®çš„ Supabase å‡­è¯
4. **æµ‹è¯•**ï¼šéƒ¨ç½²åå…ˆæ’å…¥æµ‹è¯•æ•°æ®ï¼ŒéªŒè¯å‰ç«¯èƒ½æ­£å¸¸æ˜¾ç¤º

---

## ğŸ¯ æœªæ¥åŠŸèƒ½å‡†å¤‡

æ–°è¡¨ç»“æ„å·²ä¸ºä»¥ä¸‹åŠŸèƒ½åšå¥½å‡†å¤‡ï¼š

- âœ… ç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼ˆ`author_id` å­—æ®µï¼‰
- âœ… åå°ç®¡ç†é¡µé¢ï¼ˆ`status`, `deleted_at` å­—æ®µï¼‰
- âœ… è‰ç¨¿åŠŸèƒ½ï¼ˆ`status='draft'`ï¼‰
- âœ… è½¯åˆ é™¤ï¼ˆ`deleted_at` å­—æ®µï¼‰
- âœ… æµè§ˆç»Ÿè®¡ï¼ˆ`view_count` å­—æ®µï¼‰
- âœ… ç‚¹èµåŠŸèƒ½ï¼ˆ`like_count` å­—æ®µï¼‰

---

**è¿ç§»å®Œæˆï¼** ğŸ‰

ç°åœ¨å¯ä»¥åœ¨ Supabase ä¸­åˆ›å»ºè¡¨ï¼Œç„¶åéƒ¨ç½²åˆ° Vercel äº†ã€‚
